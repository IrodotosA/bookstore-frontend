<!-- HERO -->
<div class="wishlist-hero">
  <div class="wishlist-hero-content">
    <h1>Your Wishlist</h1>
    <p>Save your favorite books for later.</p>
  </div>
</div>

<div class="wishlist-page">

    <div class="wishlist-search" *ngIf="books.length > 0">
        <p-iconfield iconPosition="left" class="w-full md:w-6">
            <p-inputicon>
            <i class="pi pi-search"></i>
            </p-inputicon>

            <input
            pInputText
            type="text"
            placeholder="Search wishlist..."
            class="w-full"
            [(ngModel)]="searchQuery"
            (input)="applySearch()"
            />
        </p-iconfield>

        <!-- EMPTY WISHLIST BUTTON -->
        <button
          pButton
          label="Empty Wishlist"
          icon="pi pi-trash"
          class="p-button-danger ml-3"
          (click)="emptyWishlist()">
        </button>
    </div>

  <!-- Empty -->
  <div *ngIf="!loading && books.length === 0" class="empty-box">
    <h2>Your wishlist is empty</h2>
    <p>Looks like you haven't saved any books yet.</p>

    <button 
      pButton 
      label="Browse Books"
      class="shop-more-btn mt-3"
      (click)="goToShop()">
    </button>
  </div>

  <!-- Wishlist Grid -->
  <div class="grid p-3" *ngIf="books.length > 0">
    <div class="col-12 md:col-6 lg:col-4" *ngFor="let book of filteredBooks">

      <div class="card-wrapper">
      <p-card styleClass="h-full">

        <!-- HEART -->
        <div class="wishlist-heart" (click)="toggleWishlist(book)">
          <i class="pi"
             [ngClass]="isInWishlist(book._id) ? 'pi-heart-fill filled' : 'pi-heart'">
          </i>
        </div>

        <!-- IMAGE -->
        <img 
          [src]="'http://localhost:4000' + book.imageUrl"
          [alt]="book.title"
          class="w-full h-15rem object-cover mb-3"/>

        <ng-template pTemplate="title">
          {{ book.title }}
        </ng-template>

        <ng-template pTemplate="subtitle">
          €{{ book.price }}
        </ng-template>

        <ng-template pTemplate="content">
          <p class="book-author">Author: {{ book.author }}</p>
          <p class="book-category">Category: {{ book.category }}</p>
        </ng-template>

        <ng-template pTemplate="footer">
          <div class="wishlist-actions">
            <button 
              pButton
              label="Add to Cart"
              icon="pi pi-shopping-cart"
              class="shop-more-btn"
              (click)="openAddToCart(book)">
            </button>

              <button 
                pButton
                label="Details"
                class="p-button-text"
                (click)="openDetails(book)">
            </button>
          </div>

          <!-- REMOVE BELOW -->
          <button 
            pButton
            label="Remove"
            icon="pi pi-times"
            class="p-button-danger p-button-text remove-btn-under"
            (click)="remove(book)">
          </button>
        </ng-template>

      </p-card>
      </div>

    </div>
  </div>

  <!-- DETAILS DIALOG -->
    <p-dialog 
    [(visible)]="showDetailsDialog" 
    [modal]="true"
    header="Book Details"
    [style]="{ width: '400px' }"
    [closable]="true">

    <!-- Loading -->
    <div *ngIf="!selectedBook">
        <p>Loading details...</p>
    </div>

    <!-- Details content -->
    <div *ngIf="selectedBook">

        <img 
        [src]="'http://localhost:4000' + selectedBook.imageUrl"
        class="w-full mb-3 border-round" />

        <h2>{{ selectedBook.title }}</h2>

        <p><strong>Author:</strong> {{ selectedBook.author }}</p>
        <p><strong>Category:</strong> {{ selectedBook.category }}</p>
        <p><strong>Price:</strong> €{{ selectedBook.price }}</p>

        <p class="mt-3">{{ selectedBook.description }}</p>

        <!-- Quantity -->
        <div class="flex align-items-center gap-3 mt-4">
        <label>Quantity:</label>

        <button 
            pButton 
            icon="pi pi-minus" 
            (click)="decreaseQuantity()">
        </button>

        <p-inputNumber 
            [(ngModel)]="quantity"
            [min]="1"
            inputStyleClass="w-3rem text-center">
        </p-inputNumber>

        <button 
            pButton 
            icon="pi pi-plus" 
            (click)="increaseQuantity()">
        </button>
        </div>

        <button 
        pButton 
        label="Add to Cart"
        icon="pi pi-shopping-cart"
        class="mt-4 w-full"
        (click)="confirmAddToCart($event)">
        </button>

    </div>

    </p-dialog>


  <!-- ADD TO CART DIALOG -->
  <p-dialog
    [(visible)]="showAddToCartDialog"
    [modal]="true"
    header="Add to Cart"
    [style]="{ width: '350px' }"
    [closable]="true">

    <div *ngIf="addToCartBook">

      <h2 class="mb-2">{{ addToCartBook.title }}</h2>
      <p><strong>Price:</strong> €{{ addToCartBook.price }}</p>

      <div class="flex align-items-center gap-3 mt-3">
        <button pButton icon="pi pi-minus" (click)="decreaseQuantity()"></button>

        <p-inputNumber 
          [(ngModel)]="quantity"
          [min]="1"
          inputStyleClass="w-3rem text-center">
        </p-inputNumber>

        <button pButton icon="pi pi-plus" (click)="increaseQuantity()"></button>
      </div>

      <div class="flex justify-content-end gap-2 mt-4">
        <button 
          pButton 
          label="Cancel"
          class="p-button-secondary"
          (click)="showAddToCartDialog = false">
        </button>

        <button 
          pButton 
          label="Add"
          icon="pi pi-check"
          (click)="confirmAddToCart($event)">
        </button>
      </div>

    </div>
  </p-dialog>

</div>
