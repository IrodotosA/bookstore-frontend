<div class="admin-messages">

  <h1>Messages</h1>

  <div class="toolbar">
    <input
      pInputText
      placeholder="Search by name, email or subject..."
      [(ngModel)]="searchTerm"
      (input)="filterMessages()"
      style="width: 260px; margin-right: 1rem;"
    />
  </div>

  <p-table
    [value]="filteredMessages"
    sortMode="single"
    dataKey="_id"
    [loading]="loading"
    [paginator]="true"
    [rows]="10"
    [rowsPerPageOptions]="[5, 10, 25, 50]"
    [expandedRowKeys]="expandedRows"
  >

    <!-- Expand/collapse toolbar -->
    <ng-template #caption>
      <div class="flex justify-end gap-2">
        <p-button label="Expand All" icon="pi pi-plus" text (onClick)="expandAll()" />
        <p-button label="Collapse All" icon="pi pi-minus" text (onClick)="collapseAll()" />
      </div>
    </ng-template>

    <!-- Table Header -->
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 5rem"></th>
        <th pSortableColumn="name">
          Name
          <p-sortIcon field="name"></p-sortIcon>
        </th>

        <th pSortableColumn="email">
          Email
          <p-sortIcon field="email"></p-sortIcon>
        </th>

        <th pSortableColumn="subject">
          Subject
          <p-sortIcon field="subject"></p-sortIcon>
        </th>

        <th pSortableColumn="createdAt">
          Date
          <p-sortIcon field="createdAt"></p-sortIcon>
        </th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <!-- Table Body -->
    <ng-template #body let-msg let-expanded="expanded">
      <tr>

        <!-- Expand button -->
        <td>
          <p-button
            type="button"
            [pRowToggler]="msg"
            [text]="true"
            severity="secondary"
            [rounded]="true"
            [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'">
          </p-button>
        </td>

        <td>{{ msg.name }}</td>
        <td>{{ msg.email }}</td>
        <td>{{ msg.subject }}</td>
        <td>{{ msg.createdAt | date:'medium' }}</td>

        <td>
          <button
            pButton
            icon="pi pi-trash"
            class="p-button-text p-button-danger"
            (click)="deleteMessage(msg)">
          </button>
        </td>

      </tr>
    </ng-template>

    <!-- Expanded Row -->
    <ng-template #expandedrow let-msg>
      <tr>
        <td colspan="6">
          <div class="expanded-box">
            <h4>Message</h4>
            <p>{{ msg.message }}</p>
          </div>
        </td>
      </tr>
    </ng-template>

  </p-table>

</div>