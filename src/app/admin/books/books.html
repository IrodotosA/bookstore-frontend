<div class="admin-books">

  <h1>Books</h1>

  <div class="toolbar">
    <button 
      pButton 
      label="Add Book" 
      icon="pi pi-plus"
      (click)="openNew()">
    </button>
  </div>

  <p-table 
    [value]="books" 
    [loading]="loading"
    [paginator]="true"
    [rows]="10"
    [rowsPerPageOptions]="[5, 10, 25, 50]"
    >

    <ng-template pTemplate="header">
      <tr>
        <th>Image</th>
        <th>Title</th>
        <th>Author</th>
        <th>Category</th>
        <th>Price (€)</th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-book>
      <tr>
        <td>
            <img 
            [src]="'http://localhost:4000' + book.imageUrl" 
            alt="Book image" 
            width="60" 
            height="80"
            style="object-fit: cover; border-radius: 4px;"
            />
        </td>

        <td>{{ book.title }}</td>
        <td>{{ book.author }}</td>
        <td>{{ book.category }}</td>
        <td>{{ book.price | number:'1.2-2' }}</td>
        <td>
          <button 
            pButton 
            icon="pi pi-pencil" 
            class="p-button-text"
            (click)="editBook(book)">
          </button>
          <button 
            pButton 
            icon="pi pi-trash" 
            class="p-button-text p-button-danger"
            (click)="deleteBook(book)">
          </button>
        </td>
      </tr>
    </ng-template>

  </p-table>

  <!-- DIALOG -->
  <p-dialog
    [(visible)]="bookDialog"
    [modal]="true"
    [style]="{ width: '500px' }"
    [closable]="false"
    [dismissableMask]="true"
    [header]="isEditMode ? 'Edit Book' : 'New Book'">

    <div class="form-grid">

        <div class="field">
            <label>Book Image</label>
            <input
                type="file"
                (change)="onImageSelect($event)"
                accept="image/*"
            />

            <!-- Preview -->
            <img 
                *ngIf="previewImage"
                [src]="previewImage"
                width="120"
                height="160"
                style="object-fit:cover;margin-top:10px;"
            />
        </div>


      <div class="field">
        <label>Title</label>
        <input pInputText [(ngModel)]="form.title" />
      </div>

      <div class="field">
        <label>Author</label>
        <input pInputText [(ngModel)]="form.author" />
      </div>

      <div class="field">
        <label>Category</label>
        <input pInputText [(ngModel)]="form.category" />
      </div>

      <div class="field">
        <label>Price (€)</label>
        <p-inputNumber [(ngModel)]="form.price" mode="decimal" [minFractionDigits]="2"></p-inputNumber>
      </div>

      <div class="field">
        <label>Description</label>
        <textarea pInputTextarea rows="4" [(ngModel)]="form.description"></textarea>
      </div>

    </div>

    <ng-template pTemplate="footer">
      <button pButton label="Cancel" class="p-button-text" (click)="hideDialog()"></button>
      <button pButton label="Save" (click)="saveBook()"></button>
    </ng-template>

  </p-dialog>

</div>
