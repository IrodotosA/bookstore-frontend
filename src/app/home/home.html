<div class="hero">
  <h1>Welcome to the Bookstore</h1>
  <p>Your digital library — organized, fast, and always up to date.</p>

  <button
    pButton
    label="Shop Now"
    class="mt-3"
    routerLink="/shop"
  ></button>
</div>

<section class="about-section">
  <h2>About Our Bookstore</h2>
  <p>
    We bring together stories, knowledge and inspiration.
    Discover great books, curated with care, delivered fast.
  </p>
</section>

<section class="staff-section" *ngIf="featured.length > 0">
  <h2>Staff Picks</h2>
  <p class="section-subtitle">A curated selection just for you.</p>
  <p class="section-subtitle">Discover the stories everyone is talking about.</p>
  
  <div *ngIf="!isMobile">
      <p-carousel
      [value]="featured"
      [numVisible]="3"
      [numScroll]="1"
      [circular]="true"
      [autoplayInterval]="0"
      [responsiveOptions]="responsiveOptions"
    >
      <ng-template pTemplate="item" let-book>
        <p-card class="carousel-card">

          <img
            [src]="apiUrl + book.imageUrl"
            [alt]="book.title"
            class="w-full h-15rem object-cover mb-3"
          />

          <ng-template pTemplate="title">
            {{ book.title }}
          </ng-template>

          <ng-template pTemplate="subtitle">
            €{{ book.price }}
          </ng-template>

          <ng-template pTemplate="content">
            <p class="book-author">Author: {{ book.author }}</p>
            <p class="book-category">Category: {{ book.category }}</p>

            <p class="truncate-text">
              {{ book.description }}
            </p>
          </ng-template>

          <ng-template pTemplate="footer">
            <div class="card-footer-actions">
              <button
                pButton
                label="Add to Cart"
                icon="pi pi-shopping-cart"
                (click)="openAddToCart(book)"
              ></button>

              <button
                pButton
                label="Details"
                class="p-button-text mr-2"
                (click)="openDetails(book)"
              ></button>
            </div>
          </ng-template>

        </p-card>
      </ng-template>
    </p-carousel>
  </div>

  <div *ngIf="isMobile" class="mobile-featured-list">
    <div class="mobile-card" *ngFor="let book of featured">
      <img
        [src]="apiUrl + book.imageUrl"
        class="mobile-card-img"
        [alt]="book.title"
      />

      <h3>{{ book.title }}</h3>
      <p class="price">€{{ book.price }}</p>

      <p class="truncate-text">{{ book.description }}</p>

      <div class="mt-2">
        <button pButton label="Add to Cart" icon="pi pi-shopping-cart" (click)="openAddToCart(book)" class="w-full mb-2"></button>
        <button pButton label="Details" icon="pi pi-info-circle" class="p-button-secondary w-full" (click)="openDetails(book)"></button>
      </div>
    </div>
  </div>

  <p-dialog
    [(visible)]="showAddToCartDialog"
    [modal]="true"
    header="Add to Cart"
    [style]="{ width: '350px' }"
    [closable]="true">

    <div *ngIf="addToCartBook">
      <h2 class="mb-2">{{ addToCartBook.title }}</h2>
      <p><strong>Price:</strong> €{{ addToCartBook.price }}</p>

      <div class="flex align-items-center gap-3 mt-3">
        <button pButton icon="pi pi-minus" (click)="decreaseQuantity()"></button>

        <p-inputNumber
          [(ngModel)]="quantity"
          [min]="1"
          inputStyleClass="w-3rem text-center"
        ></p-inputNumber>

        <button pButton icon="pi pi-plus" (click)="increaseQuantity()"></button>
      </div>

      <div class="flex justify-content-end gap-2 mt-4">
        <button pButton label="Cancel" class="p-button-secondary" (click)="showAddToCartDialog = false"></button>
        <button pButton label="Add" icon="pi pi-check" (click)="confirmAddToCart($event)"></button>
      </div>
    </div>
  </p-dialog>

  <p-dialog
    [(visible)]="showDetailsDialog"
    [modal]="true"
    [style]="{ width: '400px' }"
    header="Book Details"
    [closable]="true">

    <div *ngIf="!selectedBook">
      <p>Loading details...</p>
    </div>

    <div *ngIf="selectedBook">
      <img
        [src]="apiUrl + selectedBook.imageUrl"
        [alt]="selectedBook.title"
        class="w-full mb-3 border-round"
      />

      <h2>{{ selectedBook.title }}</h2>
      <p><strong>Author:</strong> {{ selectedBook.author }}</p>
      <p><strong>Category:</strong> {{ selectedBook.category }}</p>
      <p><strong>Price:</strong> €{{ selectedBook.price }}</p>

      <p class="mt-3">{{ selectedBook.description }}</p>

      <div class="flex align-items-center gap-3 mt-4">
        <label>Quantity:</label>

        <button pButton icon="pi pi-minus" (click)="decreaseQuantity()"></button>

        <p-inputNumber
          [(ngModel)]="quantity"
          [min]="1"
          inputStyleClass="w-3rem text-center"
        ></p-inputNumber>

        <button pButton icon="pi pi-plus" (click)="increaseQuantity()"></button>
      </div>

      <button pButton label="Add to Cart" icon="pi pi-shopping-cart" class="mt-4 w-full" (click)="confirmAddToCart($event)"></button>
    </div>
  </p-dialog>

  <div class="shop-more-wrapper">
    <button
      pButton
      label="Shop for more"
      icon="pi pi-arrow-right"
      styleClass="shop-more-btn"
      routerLink="/shop"
    ></button>
  </div>
</section>

<section class="about-section">
  <h2>A Place for Every Reader</h2>
  <p>
    Whether you're chasing adventure, learning something new, or escaping into fiction,
    our bookstore is designed to help you find the book that feels like it was written just for you.
  </p>
</section>

<section class="new-arrivals-section" *ngIf="books.length > 0">
  <h2>New Arrivals</h2>
  <p class="section-subtitle">Fresh stories, just added to our collection.</p>

  <div class="new-arrivals-grid">
    <div
      class="new-arrival-card"
      *ngFor="let book of books"
      [style.background-image]="'url(' + apiUrl + book.imageUrl + ')'"
      (click)="openDetails(book)"
      data-no-extension-intercept="true"
    >
      <div class="overlay"></div>

      <div class="title-area">
        <h3>{{ book.title }}</h3>
        <p class="author">{{ book.author }}</p>
      </div>
    </div>
  </div>
</section>